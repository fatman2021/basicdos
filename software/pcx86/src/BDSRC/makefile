#
# BASIC-DOS Makefile
#
# @author Jeff Parsons <Jeff@pcjs.org>
# @copyright Â© 2012-2020 Jeff Parsons
# @license MIT <https://www.pcjs.org/LICENSE.txt>
#
# This file is part of PCjs, a computer emulation software project at pcjs.org
#
ASM=MASM
LINK=LINK
EXE2BIN=EXE2BIN
AFLAGS=/DDEBUG

.ASM.COM:
	$(ASM) $(AFLAGS) /IINC $**,$*.OBJ;
	$(LINK) $*.OBJ,$*.EXE;
	$(EXE2BIN) $*.EXE $@
	DEL $*.OBJ
	DEL $*.EXE

.ASM.OBJ:
	$(ASM) $(AFLAGS) /IINC $**,$@;

.ASM.LST:
	$(ASM) $(AFLAGS) /IINC $**,$@,$*.LST;

.OBJ.EXE:
	$(LINK) $**,$@;

.EXE.COM:
	$(EXE2BIN) $** $@

BOOT\BOOT.COM: BOOT\BOOT.ASM

BOOT\WBOOT.COM: BOOT\WBOOT.ASM

BOOT\BOOT2.COM: BOOT\BOOT.COM
	BOOT\WBOOT.COM BOOT\BOOT.COM

DEV\NULDEV.COM: DEV\NULDEV.ASM

DEV\CONDEV.COM: DEV\CONDEV.ASM

DEV\AUXDEV.COM: DEV\AUXDEV.ASM

DEV\COMDEV.COM: DEV\COMDEV.ASM

DEV\PRNDEV.COM: DEV\PRNDEV.ASM

DEV\LPTDEV.COM: DEV\LPTDEV.ASM

DEV\CLKDEV.COM: DEV\CLKDEV.ASM

DEV\FDCDEV.COM: DEV\FDCDEV.ASM

DEV\DEVINIT.COM: DEV\DEVINIT.ASM

DEV\IBMBIO.COM: BOOT\BOOT2.COM DEV\NULDEV.COM DEV\CONDEV.COM DEV\AUXDEV.COM DEV\COMDEV.COM \
	DEV\PRNDEV.COM DEV\LPTDEV.COM DEV\CLKDEV.COM DEV\FDCDEV.COM DEV\DEVINIT.COM
	COPY /B BOOT\BOOT2.COM+DEV\NULDEV.COM+DEV\CONDEV.COM+DEV\AUXDEV.COM+DEV\COMDEV.COM+DEV\PRNDEV.COM DEV\IBMBIO.TMP
	COPY /B DEV\IBMBIO.TMP+DEV\LPTDEV.COM+DEV\CLKDEV.COM+DEV\FDCDEV.COM+DEV\DEVINIT.COM DEV\IBMBIO.COM
	DEL DEV\IBMBIO.TMP

DOS\DOSDATA.OBJ: DOS\DOSDATA.ASM

DOS\DOSINTS.OBJ: DOS\DOSINTS.ASM

DOS\CONIO.OBJ: DOS\CONIO.ASM

DOS\DEVICE.OBJ: DOS\DEVICE.ASM

DOS\DISK.OBJ: DOS\DISK.ASM

DOS\HANDLE.OBJ: DOS\HANDLE.ASM

DOS\MEMORY.OBJ: DOS\MEMORY.ASM

DOS\MISC.OBJ: DOS\MISC.ASM

DOS\PROCESS.OBJ: DOS\PROCESS.ASM

DOS\SESSION.OBJ: DOS\SESSION.ASM

DOS\UTILITY.OBJ: DOS\UTILITY.ASM

DOS\SYSINIT.OBJ: DOS\SYSINIT.ASM

DOS\IBMDOS.COM: DOS\DOSDATA.OBJ DOS\DOSINTS.OBJ DOS\CONIO.OBJ DOS\DEVICE.OBJ \
	DOS\DISK.OBJ DOS\HANDLE.OBJ DOS\MEMORY.OBJ DOS\MISC.OBJ DOS\PROCESS.OBJ \
	DOS\SESSION.OBJ DOS\UTILITY.OBJ DOS\SYSINIT.OBJ
	$(LINK) @DOS\$*.LRF
	$(EXE2BIN) DOS\$*.EXE $@
	DEL DOS\$*.EXE

UTIL\COMMAND.COM: UTIL\COMMAND.ASM

UTIL\PRIMES.COM: UTIL\PRIMES.ASM

UTIL\TESTS.COM: UTIL\TESTS.ASM
